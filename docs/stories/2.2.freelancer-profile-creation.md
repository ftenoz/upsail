# Story 2.2: Freelancer profile creation

## Status
Ready for Review

## Story
**As a** Freelancer user,  
**I want** to create and edit a professional profile,  
**so that** companies can assess my qualifications quickly.

## Acceptance Criteria
1. Freelancer can add skills, certifications, location, availability, and LinkedIn.
2. Freelancer profile is visible on applications and job browsing views.

## Tasks / Subtasks
- [x] Task 1: Add FreelancerProfile persistence (AC: 1)
  - [x] Create `FreelancerProfile` entity and TypeORM migration
  - [x] Add DTOs for create/update with validation
  - [x] Add freelancer module/controller/service endpoints for create, update, and fetch
  - [x] Enforce freelancer role guards on write endpoints
- [x] Task 2: Freelancer profile UI (AC: 1)
  - [x] Add freelancer profile form under `apps/web/src/app/freelancer` (create/edit)
  - [x] Add freelancer profile service in `apps/web/src/services`
  - [x] Use shared types from `packages/shared` for profile shape
- [x] Task 3: Company visibility (AC: 2)
  - [x] Add public freelancer profile view route (e.g., `/freelancer/[freelancerId]`)
  - [x] Link to freelancer profile from a company-facing view (e.g., applications list or job detail)
- [x] Task 4: Tests (AC: 1, 2)
  - [x] Backend integration tests for create/update/get profile
  - [x] Frontend tests for profile form and display component
- [x] Task 5: Docs updates (AC: 1, 2)
  - [x] Update docs if new endpoints or env/config notes are needed

## Dev Notes

**Previous Story Insights**
- Auth is cookie-based; cross-site profile creation requires `SameSite=None` in production. [Source: docs/stories/2.1.company-profile-creation.md#Completion-Notes-List]
- Dependencies: Requires Epic 1 auth + role guards (freelancer role, JWT cookie) to protect `/freelancer/profile`. [Source: docs/architecture/api-specification.md#paths]

**Relevant Source Tree**
- `apps/api/src/modules/*` for module/controller/service structure. [Source: docs/architecture/backend-architecture.md#service-architecture]
- `apps/web/src/app/(freelancer)` routes for freelancer UI. [Source: docs/architecture/frontend-architecture.md#routing-architecture]
- `apps/web/src/services` for API client/service layer (no direct fetch in components). [Source: docs/architecture/frontend-architecture.md#frontend-services-layer]
- `packages/shared/src/types` for shared domain types. [Source: docs/architecture/components.md#shared-types-package]
- `apps/api/src/migrations` for TypeORM migrations. [Source: docs/architecture/unified-project-structure.md#unified-project-structure]

**Data Models**
- FreelancerProfile: `id`, `userId`, `skills`, `certifications`, `location`, `availability`, `linkedInUrl`. [Source: docs/architecture/data-models.md#freelancerprofile]
- FreelancerProfile 1:1 User. [Source: docs/architecture/data-models.md#freelancerprofile]

**Database Schema**
- `freelancer_profiles` table with array fields for skills/certifications and optional LinkedIn URL. [Source: docs/architecture/database-schema.md#database-schema]

**API Specifications**
- `/freelancer/profile` GET/POST/PUT for own profile management. [Source: docs/architecture/api-specification.md#paths]

**Component Specifications**
- Use App Router structure and standard component patterns. [Source: docs/architecture/frontend-architecture.md#component-architecture]
- Frontend services layer for API calls; avoid direct fetch. [Source: docs/architecture/frontend-architecture.md#frontend-services-layer]

**Testing Requirements**
- Backend integration tests under `apps/api/tests/integration`. [Source: docs/architecture/testing-strategy.md#backend-tests]
- Frontend tests under `apps/web/tests`. [Source: docs/architecture/testing-strategy.md#frontend-tests]

**Technical Constraints**
- Shared types only from `packages/shared`; no duplicate interfaces. [Source: docs/architecture/coding-standards.md#critical-fullstack-rules]
- DTO validation with `class-validator` for API inputs. [Source: docs/architecture/coding-standards.md#critical-fullstack-rules]
- Protected endpoints must declare required roles. [Source: docs/architecture/coding-standards.md#critical-fullstack-rules]

**Assumptions & Edge Cases**
- Unauthenticated access to `/freelancer/profile` returns 401; role mismatch returns 403. [Source: docs/architecture/api-specification.md#components]
- One profile per freelancer (`userId` unique). [Source: docs/architecture/database-schema.md#database-schema]
- “Applications list” refers to the company-side view of job applications in the core workflow (browse/apply/shortlist). [Source: docs/architecture/core-workflows.md#core-workflows]

## Testing
- Frontend: Vitest + RTL, tests in `apps/web/tests`. [Source: docs/architecture/testing-strategy.md#frontend-tests]
- Backend: Jest + Supertest, tests in `apps/api/tests/integration`. [Source: docs/architecture/testing-strategy.md#backend-tests]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-07 | 1.0 | Drafted story 2.2 from Epic 2. | Bob (SM) |
| 2026-01-08 | 1.1 | Implemented freelancer profile API/UI and tests. | James (Dev) |

## Dev Agent Record

### Agent Model Used
GPT-5

### Debug Log References
- Frontend tests: `npm --workspace apps/web run test`.
- Backend tests: `npm --workspace apps/api run test` with `DATABASE_URL=postgres://postgres:***@localhost:5432/postgres` (first run failed until DB was available).
- Lint: `npm --workspace apps/web run lint`, `npm --workspace apps/api run lint`.
- Builds: `npm run build`, `npm --workspace apps/api run build`.
- Prod verification: `POST /auth/register`, `POST /auth/login`, `POST /freelancer/profile`, `GET /freelancer/profile`, `GET /freelancer/:freelancerId` on `https://upsail-api-3c24829e477b.herokuapp.com`.

### Completion Notes List
- Added freelancer profile API module, migration, DTOs, and public profile endpoint.
- Added freelancer profile create/edit UI, public profile view, and company-side profile links.
- Updated auth redirects for freelancer to land on profile setup.
- Tests, lint, and builds run locally.
- Manual API verification completed against production; register/login/create/read/public all succeeded.

### File List
- apps/api/src/app.module.ts
- apps/api/src/modules/freelancer/freelancer.controller.ts
- apps/api/src/modules/freelancer/freelancer.module.ts
- apps/api/src/modules/freelancer/freelancer.service.ts
- apps/api/src/modules/freelancer/freelancer-profile.entity.ts
- apps/api/src/modules/freelancer/dto/create-freelancer-profile.dto.ts
- apps/api/src/modules/freelancer/dto/update-freelancer-profile.dto.ts
- apps/api/src/migrations/20260107193000-create-freelancer-profiles.ts
- apps/api/tests/integration/freelancer-profile.e2e-spec.ts
- apps/api/tests/integration/company-profile.e2e-spec.ts
- apps/web/src/app/freelancer/profile/page.tsx
- apps/web/src/app/freelancer/[freelancerId]/page.tsx
- apps/web/src/app/company/dashboard/page.tsx
- apps/web/src/app/(auth)/register/page.tsx
- apps/web/src/app/(auth)/login/page.tsx
- apps/web/src/services/freelancer.ts
- apps/web/tests/pages/freelancer-profile.test.tsx
- apps/web/tests/pages/auth-pages.test.tsx
- packages/shared/src/index.ts
- packages/shared/src/types/freelancer-profile.ts
- docs/architecture/api-specification.md

## QA Results
