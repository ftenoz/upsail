# Story 3.2: Job browsing and filtering

## Status
Ready for Done

## Story
**As a** Freelancer user,
**I want** to browse and filter available jobs,
**so that** I can find relevant opportunities quickly.

## Acceptance Criteria
3.2.1: Freelancer can view a list of open jobs.
3.2.2: Freelancer can filter by role/skill, location, and availability.

## Story Context
- Continues the marketplace loop after job posting so freelancers can discover relevant jobs.
- Dependencies: Story 3.1 (job posting) is complete and jobs exist to browse.

## Assumptions / Edge Cases
- Filters are optional; default view shows open jobs only.
- "Availability" in AC 3.2.2 must map to existing job fields (duration/timing) or be clarified.
- Invalid filter values should return validation errors.

## Tasks / Subtasks
- [x] Task 1: Extend jobs list API to support filters (AC: 3.2.1, 3.2.2)
  - [x] Add/extend ListJobs DTO for role/skill, location, availability filters [Source: architecture/api-specification.md#api-specification, architecture/coding-standards.md#critical-fullstack-rules]
  - [x] Map filters to Job fields (requirements, location, duration, timing) and enforce open-only default [Source: architecture/data-models.md#job, architecture/core-workflows.md#core-workflows, architecture/database-schema.md#database-schema]
  - [x] Ensure errors follow standard API error format [Source: architecture/error-handling-strategy.md#error-response-format]
- [x] Task 2: Update frontend services and freelancer jobs UI to filter results (AC: 3.2.1, 3.2.2)
  - [x] Extend jobs service to send filter query params via services layer [Source: architecture/frontend-architecture.md#frontend-services-layer]
  - [x] Add filter UI controls to `apps/web/src/app/(freelancer)/jobs` and use TanStack Query to refetch [Source: architecture/frontend-architecture.md#state-management-architecture, architecture/frontend-architecture.md#routing-architecture]
- [x] Task 3: Tests for filtering behavior (AC: 3.2.1, 3.2.2)
  - [x] Backend integration tests for filtered GET /jobs [Source: architecture/testing-strategy.md#test-organization]
  - [x] Frontend tests for filter UI interactions and results [Source: architecture/testing-strategy.md#test-organization]
  - [x] (Optional) E2E filter scenario under `apps/e2e/jobs` [Source: architecture/testing-strategy.md#test-organization]

## Dev Notes
**Previous Story Insights:** No specific guidance found in architecture docs.
**Data Models:**
- Job fields include requirements[], location, duration, timing, and status open/closed. [Source: architecture/data-models.md#job]
- Freelancer profile includes skills and availability fields (for filter semantics if needed). [Source: architecture/data-models.md#freelancerprofile]
**Database Schema:**
- `jobs` table columns and indexes on status and location. [Source: architecture/database-schema.md#database-schema]
**API Specifications:**
- `/jobs` GET lists jobs with filters. [Source: architecture/api-specification.md#api-specification]
- Core workflow uses `GET /jobs?filters`. [Source: architecture/core-workflows.md#core-workflows]
**Component Specifications:**
- Freelancer jobs route at `(freelancer)/jobs/page.tsx`; UI components under `apps/web/src/components` and `apps/web/src/features/jobs`. [Source: architecture/frontend-architecture.md#routing-architecture, architecture/frontend-architecture.md#component-architecture]
**Frontend Services Layer:**
- API calls must go through `apps/web/src/services`; TanStack Query for server state. [Source: architecture/frontend-architecture.md#frontend-services-layer, architecture/frontend-architecture.md#state-management-architecture]
**Backend Implementation Notes:**
- Jobs module under `apps/api/src/modules/jobs` with controller/service pattern. [Source: architecture/backend-architecture.md#service-architecture]
- DTO validation and role guards required on protected endpoints. [Source: architecture/coding-standards.md#critical-fullstack-rules, architecture/backend-architecture.md#authentication-and-authorization]
- Use standard API error format via global exception filter. [Source: architecture/error-handling-strategy.md#error-response-format]
**File Locations:**
- Frontend: `apps/web/src/app`, `apps/web/src/components`, `apps/web/src/features`, `apps/web/src/services`, `apps/web/tests`. [Source: architecture/unified-project-structure.md#unified-project-structure, architecture/frontend-architecture.md#component-architecture]
- Backend: `apps/api/src/modules`, `apps/api/tests`. [Source: architecture/backend-architecture.md#service-architecture, architecture/unified-project-structure.md#unified-project-structure]
- Shared types: `packages/shared/src/types`. [Source: architecture/unified-project-structure.md#unified-project-structure, architecture/components.md#shared-types-package]
**Testing Requirements:**
- Frontend tests under `apps/web/tests/pages` or `apps/web/tests/features`.
- Backend integration tests under `apps/api/tests/integration`.
- E2E tests under `apps/e2e/jobs` if used. [Source: architecture/testing-strategy.md#test-organization]
**Technical Constraints:**
- Shared types only in `packages/shared`; no duplicate interfaces. [Source: architecture/coding-standards.md#critical-fullstack-rules]
- REST API with JWT auth; no external APIs in MVP. [Source: architecture/tech-stack.md#technology-stack-table, architecture/external-apis.md#external-apis]
- API routes use kebab-case; DB tables use snake_case. [Source: architecture/coding-standards.md#naming-conventions]
**Project Structure Notes:** No conflicts found with the unified project structure. [Source: architecture/unified-project-structure.md#unified-project-structure]

### Testing
- Frameworks: Vitest + RTL for frontend, Jest + Supertest for backend, Playwright for E2E. [Source: architecture/tech-stack.md#technology-stack-table]
- Follow testing pyramid and place tests in standard locations. [Source: architecture/testing-strategy.md#testing-pyramid, architecture/testing-strategy.md#test-organization]
- Suggested scenarios: list open jobs, filter by role/skill, filter by location, filter by availability (mapped to duration/timing). [Source: architecture/testing-strategy.md#test-examples, architecture/data-models.md#job]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-09 | 0.1 | Draft story created | Bob |
| 2026-01-09 | 1.0 | Implemented job filters and tests. | James |

## Dev Agent Record
### Agent Model Used
GPT-5

### Debug Log References
None

### Completion Notes List
- Added role/skill, location, and availability filters to GET /jobs (availability matches duration or timing).
- Freelancer jobs page now applies filters via TanStack Query.
- Tests: `npm --workspace apps/web run test`, `npm --workspace apps/api run test` (with local `DATABASE_URL`).
- Lint: `npm --workspace apps/web run lint`, `npm --workspace apps/api run lint`.
- Build: `npm run build`.

### File List
- apps/api/src/modules/jobs/dto/list-jobs.dto.ts
- apps/api/src/modules/jobs/jobs.service.ts
- apps/api/tests/integration/jobs.e2e-spec.ts
- apps/web/src/app/freelancer/jobs/page.tsx
- apps/web/src/services/jobs.ts
- apps/web/tests/pages/freelancer-jobs.test.tsx
- docs/stories/3.2.story.md

## QA Results
### Review Date: 2026-01-09

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Implementation follows module/service patterns and frontend services layer. Filter handling is straightforward and consistent with the story assumptions.

### Refactoring Performed
None.

### Compliance Check
- Coding Standards: PASS
- Project Structure: PASS
- Testing Strategy: PASS
- All ACs Met: PASS

### Improvements Checklist
- [x] Validate filter behavior with backend integration tests
- [x] Validate filter UI interactions with frontend tests
- [ ] Consider making skill matching case-insensitive for better UX

### Security Review
No new sensitive paths; DTO validation and auth guard remain in place.

### Performance Considerations
Filter queries are simple; indexes already exist for status/location.

### Files Modified During Review
None.

### Gate Status
Gate: PASS - docs/qa/gates/3.2-job-browsing-and-filtering.yml
Risk profile: Not created (not requested)
NFR assessment: Not created (not requested)

### Recommended Status
Ready for Done
