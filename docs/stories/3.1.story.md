# Story 3.1: Job posting

## Status
Ready for Review

## Story
**As a** Company user,
**I want** to create and manage short-term job posts,
**so that** I can attract qualified maritime experts.

## Acceptance Criteria
3.1.1: Company can create a job post with role requirements, location, duration, and timing.
3.1.2: Company can edit or close a job post.
3.1.3: Job posts are visible to freelancers in the job feed.


## Story Context
- Part of the marketplace core loop: company creates a job, freelancers see it in the feed.
- Dependencies: authentication and CompanyProfile creation for company users must already be implemented.

## Assumptions / Edge Cases
- Assumption: authenticated company users have a CompanyProfile; define error behavior if missing.
- Edge case: non-company access to create/update/close is blocked by role guards.
- Edge case: closed jobs are not shown in the freelancer job feed.


## Tasks / Subtasks
- [x] Task 1: Define job domain types and persistence mapping (AC: 3.1.1, 3.1.2, 3.1.3)
  - [x] Ensure shared Job type matches required fields and status enum [Source: architecture/data-models.md#job, architecture/coding-standards.md#critical-fullstack-rules]
  - [x] Map Job persistence to `jobs` table schema and indexes [Source: architecture/database-schema.md#database-schema]
- [x] Task 2: Implement jobs API endpoints with validation and role guards (AC: 3.1.1, 3.1.2, 3.1.3)
  - [x] Add Jobs module controller/service for `POST /jobs`, `PUT /jobs/{jobId}`, `DELETE /jobs/{jobId}`, `GET /jobs` [Source: architecture/api-specification.md#api-specification, architecture/backend-architecture.md#service-architecture]
  - [x] Enforce company role for create/update/close and use DTO + class-validator [Source: architecture/coding-standards.md#critical-fullstack-rules, architecture/backend-architecture.md#authentication-and-authorization]
  - [x] Return consistent API errors via standard exception filter [Source: architecture/error-handling-strategy.md#error-response-format]
- [x] Task 3: Build web services and UI for company job management (AC: 3.1.1, 3.1.2)
  - [x] Add jobs service functions in `apps/web/src/services` to call API [Source: architecture/frontend-architecture.md#frontend-services-layer]
  - [x] Use TanStack Query for jobs mutations and invalidate job lists [Source: architecture/frontend-architecture.md#state-management-architecture]
  - [x] Add company job create/edit/close UI under `apps/web/src/app/(company)/jobs` and `apps/web/src/features/jobs` [Source: architecture/frontend-architecture.md#component-architecture, architecture/frontend-architecture.md#routing-architecture]
- [x] Task 4: Build freelancer job feed UI (AC: 3.1.3)
  - [x] Render open jobs list at `apps/web/src/app/(freelancer)/jobs/page.tsx` using shared Job type [Source: architecture/frontend-architecture.md#routing-architecture, architecture/data-models.md#job]
- [x] Task 5: Tests for jobs API and pages (AC: 3.1.1, 3.1.2, 3.1.3)
  - [x] Backend integration tests for jobs endpoints under `apps/api/tests/integration` [Source: architecture/testing-strategy.md#test-organization]
  - [x] Frontend page or feature tests under `apps/web/tests/pages` or `apps/web/tests/features` [Source: architecture/testing-strategy.md#test-organization]
  - [x] (Optional) E2E job posting flow under `apps/e2e/jobs` [Source: architecture/testing-strategy.md#test-organization, architecture/testing-strategy.md#test-examples]

## Dev Notes
**Previous Story Insights:** No specific guidance found in architecture docs.
**Data Models:**
- Job fields and status enum as defined in data models (id, companyId, title, description, requirements[], location, duration, timing, status open/closed). [Source: architecture/data-models.md#job]
- Job relates to CompanyProfile and Applications; companyId references company profile. [Source: architecture/data-models.md#job]
**Database Schema:**
- `jobs` table columns, defaults, and indexes on status and location. [Source: architecture/database-schema.md#database-schema]
**API Specifications:**
- `/jobs` GET (list) and POST (create). [Source: architecture/api-specification.md#api-specification]
- `/jobs/{jobId}` GET (detail), PUT (update), DELETE (close). [Source: architecture/api-specification.md#api-specification]
**Component Specifications:**
- Use Next.js App Router with `(company)` and `(freelancer)` route groups; existing route pattern includes `(company)/jobs/[jobId]/page.tsx` and `(freelancer)/jobs/page.tsx`. [Source: architecture/frontend-architecture.md#routing-architecture]
- UI components organized under `apps/web/src/components` and `apps/web/src/features/jobs`. [Source: architecture/frontend-architecture.md#component-architecture]
**Frontend Services Layer:**
- API calls must go through `apps/web/src/services` using the shared API client; no direct fetch in components. [Source: architecture/frontend-architecture.md#frontend-services-layer, architecture/coding-standards.md#critical-fullstack-rules]
- Server data via TanStack Query; mutations should invalidate relevant queries. [Source: architecture/frontend-architecture.md#state-management-architecture]
**Backend Implementation Notes:**
- Jobs module under `apps/api/src/modules/jobs` with controller/service pattern. [Source: architecture/backend-architecture.md#service-architecture]
- Protected endpoints require JWT + role guards. [Source: architecture/backend-architecture.md#authentication-and-authorization, architecture/coding-standards.md#critical-fullstack-rules]
- Validate inputs with DTOs and class-validator; return errors using standard API error format. [Source: architecture/coding-standards.md#critical-fullstack-rules, architecture/error-handling-strategy.md#error-response-format]
**File Locations:**
- Frontend: `apps/web/src/app`, `apps/web/src/components`, `apps/web/src/features`, `apps/web/src/services`, `apps/web/tests`. [Source: architecture/unified-project-structure.md#unified-project-structure, architecture/frontend-architecture.md#component-architecture]
- Backend: `apps/api/src/modules`, `apps/api/src/common`, `apps/api/tests`. [Source: architecture/backend-architecture.md#service-architecture, architecture/unified-project-structure.md#unified-project-structure]
- Shared types: `packages/shared/src/types`. [Source: architecture/unified-project-structure.md#unified-project-structure, architecture/coding-standards.md#critical-fullstack-rules]
**Testing Requirements:**
- Frontend unit tests in `apps/web/tests/pages` or `apps/web/tests/features`. [Source: architecture/testing-strategy.md#test-organization]
- Backend integration tests in `apps/api/tests/integration`. [Source: architecture/testing-strategy.md#test-organization]
- E2E tests (if added) in `apps/e2e/jobs`. [Source: architecture/testing-strategy.md#test-organization]
**Technical Constraints:**
- Shared types only in `packages/shared`; no duplicate interfaces. [Source: architecture/coding-standards.md#critical-fullstack-rules]
- API routes use kebab-case; DB tables use snake_case. [Source: architecture/coding-standards.md#naming-conventions]
- REST API with JWT auth; no external APIs in MVP. [Source: architecture/tech-stack.md#technology-stack-table, architecture/external-apis.md#external-apis]
**Project Structure Notes:** No conflicts found with the unified project structure. [Source: architecture/unified-project-structure.md#unified-project-structure]

### Testing
- Frameworks: Vitest + RTL for frontend, Jest + Supertest for backend, Playwright for E2E. [Source: architecture/tech-stack.md#technology-stack-table]
- Follow testing pyramid and place tests in the standard locations. [Source: architecture/testing-strategy.md#testing-pyramid, architecture/testing-strategy.md#test-organization]
- Suggested scenarios: company creates job, company updates/closes job, freelancer sees open jobs in feed. [Source: architecture/testing-strategy.md#test-examples]
- Success criteria: non-company create/update/close is rejected (401/403), closed jobs are excluded from GET /jobs, and company can edit/close own jobs.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-07 | 0.1 | Draft story created | Bob |

## Dev Agent Record
### Agent Model Used
GPT-5

### Debug Log References
None

### Completion Notes List
- Added shared Job type plus jobs API module and endpoints with role guards/DTOs.
- Built company job management UI and freelancer feed backed by TanStack Query.
- Tests: `npm test` (web + api pass), `npm --workspace apps/api run test` with local `DATABASE_URL`.
- Lint: `npm --workspace apps/web run lint`, `npm --workspace apps/api run lint`.
- Build: `npm run build`.

### File List
- apps/api/src/app.module.ts
- apps/api/src/modules/jobs/dto/create-job.dto.ts
- apps/api/src/modules/jobs/dto/list-jobs.dto.ts
- apps/api/src/modules/jobs/dto/update-job.dto.ts
- apps/api/src/modules/jobs/job.entity.ts
- apps/api/src/modules/jobs/jobs.controller.ts
- apps/api/src/modules/jobs/jobs.module.ts
- apps/api/src/modules/jobs/jobs.service.ts
- apps/api/tests/integration/jobs.e2e-spec.ts
- apps/web/package.json
- apps/web/src/app/company/jobs/page.tsx
- apps/web/src/app/freelancer/jobs/page.tsx
- apps/web/src/app/layout.tsx
- apps/web/src/components/query-provider.tsx
- apps/web/src/features/jobs/job-form.tsx
- apps/web/src/services/jobs.ts
- apps/web/tests/pages/company-jobs.test.tsx
- apps/web/tests/pages/freelancer-jobs.test.tsx
- packages/shared/src/index.ts
- packages/shared/src/types/job.ts
- package-lock.json

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-09 | 1.0 | Implemented jobs API, UI, and tests. | James |

## QA Results
TBD
