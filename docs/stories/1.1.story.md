# Story 1.1: Project setup and deployment baseline

## Status
Approved for Merge

## Story
**As a** platform owner,
**I want** the project initialized with a deployable baseline,
**so that** the system can be accessed in a production-like environment from the start.

## Acceptance Criteria
1.1.1: Repository initialized with standard project structure and basic documentation.
1.1.2: CI/CD (or equivalent deploy workflow) produces a working deployment target.
1.1.3: A simple canary page is accessible in the deployed environment.

## Tasks / Subtasks
- [x] Task 1: Initialize monorepo structure and workspace tooling (AC: 1.1.1)
  - [x] Create root workspace layout: `apps/web`, `apps/api`, `packages/shared`, `.github/workflows` [Source: architecture/unified-project-structure.md]
  - [x] Add baseline documentation and `.env.example` per structure [Source: architecture/unified-project-structure.md]
- [x] Task 2: Baseline web app with canary page (AC: 1.1.3)
  - [x] Create Next.js app under `apps/web` using App Router and `(public)/page.tsx` for the canary page [Source: architecture/frontend-architecture.md#routing-architecture]
  - [x] Use the UI stack (Next.js 14, Tailwind CSS, Radix UI) for the page styling as needed [Source: architecture/tech-stack.md#technology-stack-table]
- [x] Task 3: Baseline API app and health check (AC: 1.1.2)
  - [x] Create NestJS app under `apps/api` and add `GET /health` endpoint [Source: architecture/deployment-architecture.md#deployment-strategy]
- [x] Task 4: CI/CD and build scripts for deployment (AC: 1.1.2)
  - [x] Add root scripts `build:web`, `start:web`, `build:api`, `start:api`, and `test` aligned with dev/deploy commands [Source: architecture/development-workflow.md#development-commands, architecture/deployment-architecture.md#deployment-strategy]
  - [x] Add GitHub Actions workflow at `.github/workflows/ci.yaml` to run install/test/build on pushes to main [Source: architecture/unified-project-structure.md, architecture/deployment-architecture.md#ci-cd-pipeline]
- [x] Task 5: Baseline tests for canary page and health endpoint (AC: 1.1.3, 1.1.2)
  - [x] Add a frontend unit test under `apps/web/tests/pages` that validates canary page renders [Source: architecture/testing-strategy.md#test-organization]
  - [x] Add a backend integration test under `apps/api/tests/integration` for `GET /health` [Source: architecture/testing-strategy.md#test-organization]

## Dev Notes
- **Previous Story Insights:** None (no previous story exists).
- **Data Models:** No specific guidance found in architecture docs.
- **API Specifications:** Provide `GET /health` for backend health checks. [Source: architecture/deployment-architecture.md#deployment-strategy]
- **Component Specifications:** Use Next.js App Router with a public landing route at `app/(public)/page.tsx`. [Source: architecture/frontend-architecture.md#routing-architecture]
- **File Locations:** Follow monorepo layout in `apps/web`, `apps/api`, `packages/shared`, and `.github/workflows/ci.yaml`. [Source: architecture/unified-project-structure.md]
- **Coding Standards:** Shared types only in `packages/shared` and frontend service layer only (no direct fetch in components). [Source: architecture/coding-standards.md#critical-fullstack-rules]
- **Technical Constraints:** Node 20 for CI, npm workspaces monorepo, Heroku deployment targets for web/api with build/start commands. [Source: architecture/deployment-architecture.md#ci-cd-pipeline, architecture/high-level-architecture.md#repository-structure, architecture/deployment-architecture.md#deployment-strategy]
- **Environment Variables:** Include `NEXT_PUBLIC_API_BASE_URL` in `.env.local`, and `DATABASE_URL`, `JWT_SECRET`, `NODE_ENV` in backend `.env`. Ensure `.env.example` documents these. [Source: architecture/development-workflow.md#environment-configuration]
- **Project Structure Notes:** No conflicts found with the unified project structure. [Source: architecture/unified-project-structure.md]
- **Edge Cases:** Deployment fails or env vars missing should result in clear build/test failures; canary page should still render minimal content even if API is unreachable. [Source: architecture/deployment-architecture.md#ci-cd-pipeline]

### Testing
- **Frameworks:** Frontend tests use Vitest + React Testing Library; backend tests use Jest + Supertest. [Source: architecture/tech-stack.md#technology-stack-table]
- **Locations:** Place frontend tests under `apps/web/tests/pages` and backend tests under `apps/api/tests/integration`. [Source: architecture/testing-strategy.md#test-organization]
- **Pattern:** Follow testing pyramid guidance and keep the canary page test as a unit test; health check test as backend integration. [Source: architecture/testing-strategy.md#testing-pyramid]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2026-01-04 | 0.1 | Draft story created | Bob |
| 2026-01-04 | 0.2 | Added env vars, CI path, backend test, and edge case notes | Bob |
| 2026-01-04 | 1.0 | Implemented baseline monorepo, apps, tests, and CI | James |
| 2026-01-04 | 1.1 | Added ESLint config and linted web app | James |
| 2026-01-04 | 1.2 | Manual verification of canary page and health endpoint | James |
| 2026-01-04 | 1.3 | Upgraded Next.js to 14.2.35 and revalidated | James |
| 2026-01-04 | 1.4 | Added API linting and resolved lint errors | James |
| 2026-01-04 | 1.5 | Re-ran full test/build/lint suite | James |

## Dev Agent Record
### Agent Model Used
GPT-5 (Codex CLI)

### Debug Log References
N/A

### Completion Notes List
- Implemented monorepo baseline with Next.js web, NestJS API, shared package, and CI workflow.
- Ran `npm test`, `npm run build:web`, and `npm run build:api`.
- `next build` updated `apps/web/tsconfig.json` with Next.js recommendations.
- Added ESLint config for Next.js and ran `npm --workspace apps/web run lint`.
- Manually verified `GET /health` and canary page via local start commands.
- Upgraded Next.js to 14.2.35 and re-ran tests, builds, and lint.
- Added API ESLint config and fixed lint issues; ran `npm --workspace apps/api run lint`.
- Re-ran full test/build/lint suite after API linting changes.

### File List
- .env.example
- .github/workflows/ci.yaml
- package-lock.json
- README.md
- package.json
- apps/web/.eslintrc.json
- apps/web/package.json
- apps/web/tsconfig.json
- apps/web/next-env.d.ts
- apps/web/next.config.js
- apps/web/tailwind.config.ts
- apps/web/postcss.config.js
- apps/web/vitest.config.ts
- apps/web/tests/setup.ts
- apps/web/tests/pages/canary-page.test.tsx
- apps/web/src/app/globals.css
- apps/web/src/app/layout.tsx
- apps/web/src/app/(public)/page.tsx
- apps/api/package.json
- apps/api/.eslintrc.json
- apps/api/tsconfig.json
- apps/api/tsconfig.eslint.json
- apps/api/jest.config.ts
- apps/api/src/main.ts
- apps/api/src/app.module.ts
- apps/api/src/modules/health/health.module.ts
- apps/api/src/modules/health/health.controller.ts
- apps/api/src/common/filters/http-exception.filter.ts
- apps/api/tests/integration/health.e2e-spec.ts
- packages/shared/package.json
- packages/shared/tsconfig.json
- packages/shared/src/index.ts
- packages/shared/src/types/api.ts

## QA Results

### Review Date: 2026-01-05

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Implementation is straightforward and aligned with baseline goals; the canary page and health endpoint are minimal and readable. CI runs test and build steps but does not verify deployment in a target environment.

### Refactoring Performed
- None.

### Compliance Check
- Coding Standards: Pass (no issues observed in reviewed files)
- Project Structure: Pass (matches expected monorepo layout)
- Testing Strategy: Concerns (AC 1.1.1 and deployment verification rely on manual checks)
- All ACs Met: Concerns (deployment target verification not automated)
- Process: Story status is "Ready for Review"; review workflow expects "Review"

### Improvements Checklist
- [ ] Add a deployment-target smoke check to validate AC 1.1.2 (CI or staging ping)
- [ ] Add a lightweight repo structure/docs check for AC 1.1.1 (script or CI step)
- [ ] Consider an end-to-end canary page smoke check in the deployed environment

### Security Review
No auth or sensitive data handling in scope; no security issues found.

### Performance Considerations
Minimal endpoints and static page; no issues found.

### Files Modified During Review
- None.

### Gate Status
Gate: CONCERNS docs/qa/gates/1.1-project-setup-and-deployment-baseline.yml
Risk profile: not created
NFR assessment: not created

### Recommended Status
Changes Required - See unchecked items above

### Review Date: 2026-01-05

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
Added automated structure validation and deployment smoke checks. Changes are small, script-based, and scoped to CI; no product code changes.

### Refactoring Performed
- None.

### Compliance Check
- Coding Standards: Pass (scripts are simple and readable)
- Project Structure: Pass (structure validation script enforces baseline)
- Testing Strategy: Pass (deployment smoke check complements tests)
- All ACs Met: Pass (AC 1.1.1, 1.1.2, 1.1.3 now have automated checks)
- Process: Story status is "Ready for Review"; review workflow expects "Review"

### Improvements Checklist
- [x] Add a deployment-target smoke check to validate AC 1.1.2 (CI or staging ping)
- [x] Add a lightweight repo structure/docs check for AC 1.1.1 (script or CI step)
- [ ] Consider an end-to-end canary page smoke check in the deployed environment

### Security Review
No auth or sensitive data handling in scope; no security issues found.

### Performance Considerations
No performance concerns; scripts run quickly and only in CI.

### Files Modified During Review
- .github/workflows/ci.yaml
- package.json
- scripts/deployment-smoke-check.js
- scripts/validate-structure.js

### Gate Status
Gate: PASS `docs/qa/gates/1.1-project-setup-and-deployment-baseline.yml`
Risk profile: not created
NFR assessment: not created

### Recommended Status
Ready for Done


### Review Date: 2026-01-05

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
CI now enforces repository structure validation and a deployment smoke check using configured deployment URLs. Changes are small, script-based, and focused on automation.

### Refactoring Performed
- None.

### Compliance Check
- Coding Standards: Pass (scripts are simple and readable)
- Project Structure: Pass (structure validation enforces baseline)
- Testing Strategy: Pass (smoke check complements tests; requires DEPLOYMENT_WEB_URL/DEPLOYMENT_API_URL in CI secrets)
- All ACs Met: Pass (AC 1.1.1, 1.1.2, 1.1.3 covered)
- Process: Story status is "Ready for Review"; review workflow expects "Review"

### Improvements Checklist
- [x] Add a deployment-target smoke check to validate AC 1.1.2 (CI or staging ping)
- [x] Add a lightweight repo structure/docs check for AC 1.1.1 (script or CI step)
- [ ] Consider an end-to-end canary page smoke check in the deployed environment

### Security Review
No auth or sensitive data handling in scope; no security issues found.

### Performance Considerations
No performance concerns; scripts run quickly and only in CI.

### Files Modified During Review
- None.

### Gate Status
Gate: PASS docs/qa/gates/1.1-project-setup-and-deployment-baseline.yml
Risk profile: not created
NFR assessment: not created

### Recommended Status
Ready for Done
